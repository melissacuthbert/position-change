import React, { useState, useEffect } from 'react';

const App = () => {
    const [originalAnnualSalary, setOriginalAnnualSalary] = useState(50380);
    const [originalWeeklyHours, setOriginalWeeklyHours] = useState(32);
    const [originalMonthlyQuota, setOriginalMonthlyQuota] = useState(9250);
    const [originalCommissionPercentage, setOriginalCommissionPercentage] = useState(0.52);

    const [changeDate, setChangeDate] = useState('2025-07-20');
    const [newAnnualSalary, setNewAnnualSalary] = useState(42900);
    const [newWeeklyHours, setNewWeeklyHours] = useState(24);
    const [newMonthlyQuota, setNewMonthlyQuota] = useState(6500);
    const [newCommissionPercentage, setNewCommissionPercentage] = useState(0.60);

    const [totalMonthlyRevenue, setTotalMonthlyRevenue] = useState(18000);

    const [proratedBase, setProratedBase] = useState(0);
    const [totalQuota, setTotalQuota] = useState(0);
    const [totalCommission, setTotalCommission] = useState(0);
    const [totalPay, setTotalPay] = useState(0);

    // Helper function to get the number of days in a month
    const daysInMonth = (month, year) => {
        // month is 0-indexed for the Date object, so we add 1
        return new Date(year, month + 1, 0).getDate();
    };

    useEffect(() => {
        // Only run calculation if changeDate is a valid date string
        if (!changeDate) {
            return;
        }

        try {
            // Parse date parts manually to avoid timezone issues
            const [yearStr, monthStr, dayStr] = changeDate.split('-');
            const year = parseInt(yearStr, 10);
            const month = parseInt(monthStr, 10) - 1; // getMonth() is 0-indexed
            const dayOfChange = parseInt(dayStr, 10);
            
            const totalDaysInMonth = daysInMonth(month, year);
            
            // Calculate days in each position
            const daysInOriginalPosition = dayOfChange - 1;
            const daysInNewPosition = totalDaysInMonth - daysInOriginalPosition;
            
            if (daysInOriginalPosition < 0 || daysInNewPosition < 0) {
                 // Handle invalid date inputs
                 return;
            }

            // Calculate daily salaries
            const originalDailySalary = (originalAnnualSalary / 52) / 7;
            const newDailySalary = (newAnnualSalary / 52) / 7;

            // Prorated Base Salary
            const proratedOriginalBase = originalDailySalary * daysInOriginalPosition;
            const proratedNewBase = newDailySalary * daysInNewPosition;
            const calculatedProratedBase = proratedOriginalBase + proratedNewBase;

            // Prorated Quota
            const proratedOriginalQuota = (originalMonthlyQuota / totalDaysInMonth) * daysInOriginalPosition;
            const proratedNewQuota = (newMonthlyQuota / totalDaysInMonth) * daysInNewPosition;
            const calculatedTotalQuota = proratedOriginalQuota + proratedNewQuota;
            
            // Weighted Commission Percentage
            const weightedCommissionPercentage = (
                (originalCommissionPercentage * daysInOriginalPosition) + 
                (newCommissionPercentage * daysInNewPosition)
            ) / totalDaysInMonth;

            // Commission Calculation
            const commissionableRevenue = Math.max(0, totalMonthlyRevenue - calculatedTotalQuota);
            const calculatedTotalCommission = commissionableRevenue * weightedCommissionPercentage;
            
            // Total Pay
            const calculatedTotalPay = calculatedProratedBase + calculatedTotalCommission;

            // Update state with calculated values
            setProratedBase(calculatedProratedBase);
            setTotalQuota(calculatedTotalQuota);
            setTotalCommission(calculatedTotalCommission);
            setTotalPay(calculatedTotalPay);
        } catch (error) {
            console.error("Calculation failed:", error);
            // Optionally clear results or show an error message
        }
    }, [
        originalAnnualSalary, originalMonthlyQuota, originalCommissionPercentage,
        changeDate, newAnnualSalary, newMonthlyQuota, newCommissionPercentage,
        totalMonthlyRevenue
    ]);

    const formatCurrency = (value) => {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
    };

    return (
        <div className="bg-gray-100 p-4 sm:p-8 flex items-center justify-center min-h-screen">
            <div className="bg-white p-6 sm:p-8 rounded-2xl shadow-xl w-full max-w-4xl border border-gray-200">
                <h1 className="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-6 text-center">Mid-Month Pay Calculator</h1>
                <p className="text-center text-gray-600 mb-8">
                    Calculate prorated base salary and commission for a mid-month position change.
                </p>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    {/* Original Position Inputs */}
                    <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h2 className="text-xl font-bold text-gray-800 mb-4">Original Position</h2>
                        <div className="space-y-4">
                            <div>
                                <label htmlFor="originalAnnualSalary" className="block text-sm font-medium text-gray-700">Annual Base Salary</label>
                                <input type="number" id="originalAnnualSalary" value={originalAnnualSalary} onChange={(e) => setOriginalAnnualSalary(parseFloat(e.target.value))} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                            </div>
                            <div>
                                <label htmlFor="originalWeeklyHours" className="block text-sm font-medium text-gray-700">Weekly Hours</label>
                                <input type="number" id="originalWeeklyHours" value={originalWeeklyHours} onChange={(e) => setOriginalWeeklyHours(parseFloat(e.target.value))} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                            </div>
                            <div>
                                <label htmlFor="originalMonthlyQuota" className="block text-sm font-medium text-gray-700">Monthly Quota ($)</label>
                                <input type="number" id="originalMonthlyQuota" value={originalMonthlyQuota} onChange={(e) => setOriginalMonthlyQuota(parseFloat(e.target.value))} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                            </div>
                            <div>
                                <label htmlFor="originalCommissionPercentage" className="block text-sm font-medium text-gray-700">Commission % (e.g., 0.52 for 52%)</label>
                                <input type="number" step="0.01" id="originalCommissionPercentage" value={originalCommissionPercentage} onChange={(e) => setOriginalCommissionPercentage(parseFloat(e.target.value))} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                            </div>
                        </div>
                    </div>

                    {/* New Position Inputs */}
                    <div className="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h2 className="text-xl font-bold text-gray-800 mb-4">New Position</h2>
                        <div className="space-y-4">
                            <div>
                                <label htmlFor="changeDate" className="block text-sm font-medium text-gray-700">Date of Change</label>
                                <input type="date" id="changeDate" value={changeDate} onChange={(e) => setChangeDate(e.target.value)} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                            </div>
                            <div>
                                <label htmlFor="newAnnualSalary" className="block text-sm font-medium text-gray-700">New Annual Base Salary</label>
                                <input type="number" id="newAnnualSalary" value={newAnnualSalary} onChange={(e) => setNewAnnualSalary(parseFloat(e.target.value))} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                            </div>
                            <div>
                                <label htmlFor="newWeeklyHours" className="block text-sm font-medium text-gray-700">New Weekly Hours</label>
                                <input type="number" id="newWeeklyHours" value={newWeeklyHours} onChange={(e) => setNewWeeklyHours(parseFloat(e.target.value))} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                            </div>
                            <div>
                                <label htmlFor="newMonthlyQuota" className="block text-sm font-medium text-gray-700">New Monthly Quota ($)</label>
                                <input type="number" id="newMonthlyQuota" value={newMonthlyQuota} onChange={(e) => setNewMonthlyQuota(parseFloat(e.target.value))} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                            </div>
                            <div>
                                <label htmlFor="newCommissionPercentage" className="block text-sm font-medium text-gray-700">Commission % (e.g., 0.60 for 60%)</label>
                                <input type="number" step="0.01" id="newCommissionPercentage" value={newCommissionPercentage} onChange={(e) => setNewCommissionPercentage(parseFloat(e.target.value))} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                            </div>
                        </div>
                    </div>
                </div>

                {/* Revenue Input */}
                <div className="mb-8">
                    <h2 className="text-xl font-bold text-gray-800 mb-4">Actual Monthly Revenue</h2>
                    <label htmlFor="totalMonthlyRevenue" className="block text-sm font-medium text-gray-700">Total Monthly Revenue Achieved ($)</label>
                    <input type="number" id="totalMonthlyRevenue" value={totalMonthlyRevenue} onChange={(e) => setTotalMonthlyRevenue(parseFloat(e.target.value))} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-2.5" />
                </div>

                {/* Results Section */}
                <div id="results" className="mt-8 p-6 bg-blue-50 rounded-xl border border-blue-200 shadow-inner">
                    <h2 className="text-2xl font-bold text-blue-800 mb-4 text-center">Results</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-center text-gray-800">
                        <div className="p-4 bg-white rounded-lg shadow-sm border border-blue-100">
                            <p className="text-sm font-medium text-gray-500">Prorated Base Salary</p>
                            <p id="proratedBase" className="text-2xl font-extrabold text-blue-600 mt-1">{formatCurrency(proratedBase)}</p>
                        </div>
                        <div className="p-4 bg-white rounded-lg shadow-sm border border-blue-100">
                            <p className="text-sm font-medium text-gray-500">Total Prorated Quota</p>
                            <p id="totalQuota" className="text-2xl font-extrabold text-blue-600 mt-1">{formatCurrency(totalQuota)}</p>
                        </div>
                        <div className="p-4 bg-white rounded-lg shadow-sm border border-blue-100">
                            <p className="text-sm font-medium text-gray-500">Total Commission Earned</p>
                            <p id="totalCommission" className="text-2xl font-extrabold text-blue-600 mt-1">{formatCurrency(totalCommission)}</p>
                        </div>
                        <div className="p-4 bg-white rounded-lg shadow-sm border border-blue-100">
                            <p className="text-sm font-medium text-gray-500">Total Monthly Pay</p>
                            <p id="totalPay" className="text-2xl font-extrabold text-green-600 mt-1">{formatCurrency(totalPay)}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
};

export default App;
